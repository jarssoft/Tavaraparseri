<!DOCTYPE html>
<html>
  <head>
    
    <link rel="stylesheet" type="text/css" href="tavpar.css">
    <title>Tavaraparseri by Jari</title>
    <meta charset="utf-8">
    
    <script id="tavaraxml" type="text/xmldata">
    </script>​
    
    <script type="text/javascript">
    
    var reader; //GLOBAL File Reader object for demo purpose only
    //var output = ""; //placeholder for text output
    var xmlfile = "";
    var kasikirjoitus = "";
    var days = [];
    var laske = true;
    /**
     * Check for the various File API support.
     */
    function checkFileAPI() {
        if (window.File && window.FileReader && window.FileList && window.Blob) {
            reader = new FileReader();
            return true; 
        } else {
            alert('The File APIs are not fully supported by your browser. Fallback required.');
            return false;
        }
    }
    
    //
    //  This function converts an XML to JS objects and arrays.
    //
    function convertXmlToStructure(x) {

        //
        //  Output function.
        //
        var o = {
            _text: '',
        };

        //
        //  c = each child
        //
        var c = x.firstChild;

        //
        //  Loop through child nodes.
        //
        while (c) {

            //
            //  Add to _text property if it is a text.
            //
            if (c.nodeName == '#text') {
                o._text += c.nodeValue;

            //
            //  Else if it is a normal node.
            //
            } else if (c.nodeType == 1) {

                //
                //  Create property for each node name.
                //
                if (typeof o[c.nodeName] == 'undefined')
                    o[c.nodeName] = [];
                o[c.nodeName][o[c.nodeName].length] = convertXmlToStructure(c);

            }

            //
            //  ...Next!
            //
            c = c.nextSibling;

        }

        //
        //  Now, attributes!
        //
        var a = x.attributes;
        var i = 0;
        if (a) {
            for (var i = 0; i < a.length; i ++) {
                o[a[i].name] = a[i].value;
            }
        }

        //
        //  Clean the text
        //
        if (o._text.match(/^\\s*$/))
            delete o._text;

        //
        //  Finished!
        //
        return o;

    }

    var pattpvm1 = new RegExp("^([1-9][0-9]?)\\.([1-9][0-9]?)\.?");
    var pattpvm2 = new RegExp("^([1-9][0-9]?)\\.([1-9][0-9]?)\\.(20|-)?([0-9][0-9])");           
    
    var pvmvirhe = "";
    var pvmpienin=null;
    var pvmsuurin=null;
    var paivienmaara=0;
    
    Date.prototype.getWeek = function() {
        var onejan = new Date(this.getFullYear(), 0, 1);
        return Math.ceil((((this - onejan) / 86400000) + onejan.getDay() + 1) / 7);
    }

    var dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];


    function dateCapture(capture, date) {
        var month=capture[2];
        var day=capture[1];
        //alert(capture[4]);
        if(month.length==1)
            month="0"+month;
        if(day.length==1)
            day="0"+day;
            
        var year=null;
        if(capture[4]!== undefined)
            year="20"+capture[4];
        else
            if(date==null){
                return null;
            }else
                var year=date.getFullYear().toString();
                
        var newdate = new Date(year+"-"+month+"-"+day);
        //alert(year+"-"+month+"-"+day);
        pvmvirhe="";    
        var today = new Date();

        if(newdate > today)
            pvmvirhe = "Päivämäärä on tulevaisuudessa!";
        
	    //onko yksikään päivämäärä merkitty
        if(pvmsuurin==null){
            pvmpienin=newdate;
			pvmsuurin=newdate;
			paivienmaara++;
		}else{
			//jos eri kuin aiempi
			if(newdate < pvmpienin){
				pvmvirhe = "Päivämäärän väärässä järjestyksessä!";
				pvmpienin = newdate;
			}
			if(newdate > pvmsuurin){
				pvmsuurin = newdate;
				paivienmaara++;
			}
		}

        return newdate;
    
    }
    
    var pattkpl1 = new RegExp("^([1-9][0-9]?) ?(x|kpl|pkt)? ");   
    var pattkpl2 = new RegExp(" x? ?([1-9][0-9]?) ?(kpl|pkt)?\r$");
    
    var parser = new DOMParser();
    var xmlDoc = null;//parser.parseFromString(document.getElementById('tavaraxml').innerHTML,"text/xml");
    var juuriluokka = null;//xmlDoc.getElementsByTagName("luokitus")[0]
        
    function orginal(text) {
    
        var html="";
        pvmpienin=null;
        pvmsuurin=null;
        paivienmaara=0;
        
        if(text!=""){
    
        var rivit=text.split("\n");
        html="<pre>";
        var arrayLength = rivit.length;
        var haspvm=false;
        var paivays=null;
        var virhecount=0;
               
        for (var i = 0; i < arrayLength; i++){
            
            var rivi=rivit[i];
            var ln='<span class=\"ln\">'+(i+1).toString()+"</span> ";
            
            
            if(rivi[0]=='#'){
                html=html+ln+"<i style=\"color:gray\">"+rivi+"</i>"; //+"<br>";
            }else{
                if(pattpvm2.test(rivi)){                    
                    haspvm=true;
                    capture = pattpvm2.exec(rivi);
                    paivays=dateCapture(capture, paivays);                    
                    rivi=rivi.replace(pattpvm2, '<span class=\"pvm\">$&</span>');      
                    if(pvmvirhe!=""){
                        rivi=rivi+"<a name=\"ekavirhe\"><span class=\"virhe\"> # Varoitus! "+pvmvirhe+"</span></a>\n";
                        virhecount++;
                        pvmvirhe="";
                    }
                }else{
                    if(pattpvm1.test(rivi)){                        
                        if(!haspvm)
                            rivi=rivi+'<span class=\"virhe\"> # Varoitus! Vuosiluku pitää merkitä, kun päivämäärä merkitään ensimmäistä kertaa.</span>\n';
                        capture = pattpvm1.exec(rivi);
                        paivays=dateCapture(capture, paivays);                                      
                        rivi=rivi.replace(pattpvm1, '<span class=\"pvm\">$&</span>');
                        if(pvmvirhe!=""){
                            rivi=rivi+"<a name=\"ekavirhe\"><span class=\"virhe\"> # Varoitus! "+pvmvirhe+"</span></a>\n";
                            virhecount=virhecount+1;
                            pvmvirhe="";
                        }                        
                    }else{
                        if(pattkpl1.test(rivi)){
                            rivi=rivi.replace(pattkpl1, '<span class=\"kpl\">$&</span>');                    
                            }
                        if(pattkpl2.test(rivi))
                            rivi=rivi.replace(pattkpl2, '<span class=\"kpl\">$&</span>');
                            
                        if(!haspvm && rivi.trim()!='')
                            rivi=rivi+'<span class=\"virhe\"> # Varoitus! Päivämäärä pitää merkitä ennen tavaroita.</span>\n';
                    }
                    
                }


                html=html+ln+rivi;//+"<br>";
            }
        }
        //var html="<h3>Alkuperäinen teksti</h3><p>Teksti värjättynä merkityksen mukaisesti. Käytä tätä näkymää korjatessa virheitä.</p><a href=\"#ekavirhe\">Siirry ekaan virheeseen.</a><pre>";

		var yhteenveto="";
        

        if(virhecount==0){
                html="<p>Tiedostossa ei näytä olevan virheitä</p>"+html;
				yhteenveto="<p>Löydettiin tavaroita ajanjaksolta "+pvmpienin.toLocaleDateString()+" - "+pvmsuurin.toLocaleDateString()+", jolta "+paivienmaara+":lta eri päivältä.</p>";
				html=yhteenveto+html;
            }else
                html="<p><span class=\"virhe\">Tiedostossa on "+virhecount.toString()+" virhettä. <a href=\"#ekavirhe\">Siirry ensimmäiseen virheeseen.</a></span></p>"+html;
            
        }else{
            html="<p>Lataa tekstitiedosto, jossa lista tavaroista.</p>Tavaralista (.txt):  <input type=\"file\" onchange=\"readText(this, kkloaded);\" />";
        }
	

        return html+"</pre>";
    }
    
	function getMonday(d) {
	    d = new Date(d);
	    var day = d.getDay(),
		    diff = d.getDate() - day + (day == 0 ? -6:1); // adjust when day is sunday
	    return new Date(d.setDate(diff));
	}

    function muotoiltuLista(text) {

        if (kasikirjoitus=="")
            return "<span class=\"virhe\">Lataa ensin tavaralista</span>";
        
        
        var rivit=text.split("\n");
        var html="";
        var arrayLength = rivit.length;
        var taso=0;
        var entviik=-1;
        var entviikpaiv=1;
		var paivays=null;
        
        html=html+"<h2>Tavarakalenteri</h2><table id=\"kalenteri\" border=\"1\"><tr><th>Vko</th><td>Maanantai</td><td>Tiistai</td><td>Keskiviikko</td><td>Torstai</td><td>Perjantai"
        //if(document.getElementById('viikonpaivat').value == 1)
        
        //var valittu = document.querySelector('input[name="viikonpaivat"]:checked').value;
        
        if(document.getElementById('kaikkipaivat').checked)
            html=html+"</td><td>Lauantai</td><td>Sunnuntai";
        
		var monthNames = [
		  "tammi", "helmi", "maalis",
		  "huhti", "touko", "kesä", "heinä",
		  "elo", "syys", "loka",
		  "marras", "joulu"
		];

        for (var i = 0; i < arrayLength; i++) {
            rivi=rivit[i];
            if(rivi[0]!='#'){
                    
                //kursivoidaan kappalemäärät
                if(pattkpl1.test(rivi))
                    rivi=rivi.replace(pattkpl1, '<i>$&</i>')
                if(pattkpl2.test(rivi))
                    rivi=rivi.replace(pattkpl2, '<i>$&</i>')
                
                //jos päivämäärä
                if(pattpvm1.test(rivi)){
                    if(taso>0){
                        //html=html+"</ul>";
                        //html=html+"<br>";
                        taso=taso-1;
                    }

                    var capture = pattpvm1.exec(rivi);
					if(pattpvm2.test(rivi))
						capture = pattpvm2.exec(rivi);
                    var paivays = dateCapture(capture, paivays);
					
					//lisätään viikko
                    var viikko=paivays.getWeek();
                    if(viikko!=entviik){
						
                        //html=html+"<h2>Viikko "+viikko.toString()+"</h2>";
                        //html=html+"<h3>"+dayNames[1]+"</h3>";
						var monday = getMonday(paivays);
						var mondaytxt=monday.getDate().toString()+". "+monthNames[monday.getMonth()];
						monday.setDate(monday.getDate() + 5); 
						var fridaytxt=monday.getDate().toString()+". "+monthNames[monday.getMonth()];
                        html=html+"</td></tr><tr><th valign=\"top\">"+viikko.toString()+"<br>("+mondaytxt+"-<br>"+fridaytxt+")</th><td valign=\"top\">"; //uusi rivi taulukossa
                        entviik=viikko;
                        entviikpaiv=1;
                    }

                            //html=html+"<h3>"+rivi+"</h3><ul>";
                            
                    //jos uusi viikonpäivä, vaihdetaan saraketta
                    var vp = paivays.getDay();
					if(vp>5)
						alert("virhe viikonpäivissä, päivä ei saa olla "+(vp).toString());
                    if(vp!=entviikpaiv){
                        for (; vp > entviikpaiv; entviikpaiv++) {
                            //html=html+"<h3>"+dayNames[entviikpaiv+1]+"</h3>";
                            html=html+"</td><td valign=\"top\">";
                            //entviikpaiv=vp;
                        }
                    }
                    //html=html+"<ul>";
                    //html=html+"<tr>";

                    taso=taso+1;
                }else{
                    if(rivi.trim().length>0)
                        //html=html+"<li>"+rivi+"</li>";
                        html=html+rivi+"<br>";
                }
            }
        }
        //alert(html);
        html=html+"</td></tr></table>";
        return html;
    }

	//testaa kategorian
    var syvintaso=0;
	var kategoriamaara=0;
	var tavaramaara=0;
	var luokitusvirhe="";
	
	function testkategoriarekursio(kategoria, syvyys) {
		if(syvyys>syvintaso)
			syvintaso=syvyys;
		kategoriamaara=kategoriamaara+1;
        var lapset = kategoria.childNodes;
        var kategoriatLength = lapset.length;	
	
		for (var i = 0; i < kategoriatLength; i++) {
			if(lapset[i].nodeName == 'kategoria')
				testkategoriarekursio(lapset[i], syvyys+1);
			if(lapset[i].nodeName == 'tavara'){
				tavaramaara=tavaramaara+1;
				if(lapset[i].childNodes.length==0)
					luokitusvirhe=luokitusvirhe+"Tavara-elementti ei saa olla tyhjä.";
			}
		}
	}
	function testkategoria(kategoria) {
	    syvintaso=0;
		kategoriamaara=0;
		tavaramaara=0;
		if(kategoria!=null)
			testkategoriarekursio(kategoria, 0);
	}
	
    //tunnistaa tavaralle kategorian
    function etsikategoria(kategoria, tavara, kpl, pvmstr) {

        var lapset = kategoria.childNodes;
        var kategoriatLength = lapset.length;
        var tilastoitu=false;
        var loytynyt=null;			
		
        for (var i = 0; i < kategoriatLength; i++) {
            if(loytynyt==null){
                if(lapset[i].nodeName == 'kategoria'){
                    loytynyt=etsikategoria(lapset[i], tavara, kpl, pvmstr);
                    continue;						
                }
                if(lapset[i].nodeName == 'tavara'){
				
                    var muoto=lapset[i].childNodes[0].nodeValue;
					var tunnistus="normaali";
					if(lapset[i].hasAttribute("tunnistus")){
						tunnistus = lapset[i].getAttribute("tunnistus");
					}
					
					if(tunnistus=="normaali"){
						if (tavara.indexOf(muoto)>-1 || muoto=="*"){
							//return lapset[i]; 
							loytynyt=lapset[i];
							continue;
						}
					}
					if(tunnistus=="kokosana"){
						if (tavara==muoto){
							loytynyt=lapset[i];
							continue;
						}
					}
					//if(lapset[i].getAttribute("kuvaus")=="luokittamaton")
					//	loytynyt=lapset[i];
					//	continue;
                }
            }else{
                if(lapset[i].nodeName == 'paiva'){
                    //jos löydettiin aikaisempi merkintä samalta päivältä
                    if(lapset[i].getAttribute("pvm")==pvmstr){
                        //summataan lukumäärät
                        //lapset[i].setAttribute("kpl", (parseInt(lapset[i].getAttribute("kpl"))+parseInt(kpl)).toString());
                        //alert(lapset[i].nodeValue);
                        textnode = lapset[i].childNodes[0];
                        textnode.nodeValue = (parseInt(textnode.nodeValue) + parseInt(kpl)).toString();
                        //lapset[i].nodeValue = (parseInt(lapset[i].nodeValue)+parseInt(kpl)).toString();
                        //var textnode = document.createTextNode("---");
                        //lapset[i].appendChild(textnode);
                        //tilastoitu=true;
                        return loytynyt;
                    }
                }
            }
        }
        
        //jos ei löytynyt päivää, luodaan se
        if(loytynyt!=null && !tilastoitu){
            var uusinode = document.createElement("paiva");
            //uusinode.setAttribute("kpl", kpl);
            uusinode.setAttribute("pvm", pvmstr);
            var textnode = document.createTextNode(kpl);
            uusinode.appendChild(textnode);
            kategoria.appendChild(uusinode);
            return loytynyt;
        }

        return null;
    }
    
    var puu="";
    var lista="";
    var taul="";
    
        
    //var bgcolors = ["hsl(0, 100%, 87.5%)", "hsl(144, 100%, 87.5%)", "hsl(288, 100%, 87.5%)", "hsl(72, 100%, 87.5%)", "hsl(216, 100%, 87.5%)", "hsl(0, 100%, 87.5%)"]; 
    
    var bgcolors = ["FFBDBD","BDFFD7","F2BDFF","F2FFBD","BDD7FF","FFBDBD","FFBDBD","BDFFD7","F2BDFF","F2FFBD","BDD7FF","FFBDBD"];
    //var bgcolors = ["FFFFFF","EEEEEE","DDDDDD","CCCCCC","BBBBBB","AAAAAA","999999","888888","777777","666666","555555","444444"];
    
    function bgc(i){
        //return " style=\"background-color: "+bgcolors[i]+"\"";
        return " bgcolor=\""+bgcolors[i]+"\"";
    }
    
    //tekee listauksen, sekä <ul>, <select>, että <tr>.
    //argumentti syvyys (>0) merkitsee, kuinka syvät kohteet otetaan mukaan.
    var jalkelaismaara=0;

    function tulostakategorianimet(kategoria, syvyys, vari) {
                
        var lapset = kategoria.childNodes;
        var kategoriatLength = lapset.length;
        var lapsihtml="";

        
        //käydään lapset läpi
        for (var i = 0; i < kategoriatLength; i++) {
            if(lapset[i].nodeName == 'kategoria'){                
                lapsihtml=lapsihtml+tulostakategorianimet(lapset[i], syvyys-1, vari);
            }
        }
        
        //var tamahtml = "<td>" + kategoria.getAttribute("id")+"&nbsp;" + kategoria.getAttribute("kuvaus") + "</td>";
                
        //jos ollaan liian syvällä
        if(syvyys<0){
            jalkelaismaara=jalkelaismaara+1;
            //return tamahtml+lapsihtml;
        }else{            
            var pal="";
            var kuvaus="";
            if(syvyys==0)
                kuvaus=kategoria.getAttribute("kuvaus");
            //jos liian syvällä olevia jalkeläisiä, lisätään colspan
            if(jalkelaismaara>0){
                pal = "<td"+bgc(syvyys+vari)+" colspan=\""+(jalkelaismaara+1).toString()+"\">"+kuvaus+"</td>";
                //pal = "<td"+bgc(syvyys+vari)+">"+kuvaus+" </td>";
                //for(i=0;i<jalkelaismaara;i++)
                //    pal = pal + "<td"+bgc(syvyys+vari)+"> </td>";
            }else
                if(syvyys==0)
                    pal = "<td"+bgc(syvyys+vari)+">"+kuvaus+" </td>"+lapsihtml;
                else
                    pal = "<td"+bgc(vari-syvyys)+"> </td>"+lapsihtml;
            jalkelaismaara=0;
            return pal;
        }
    }
    
    //tulostaa luokkien nimet taulukon yhdelle riville
    function tulostakategorianimetyhdelleriville(kategoria, syvyys, vari) {
                
        var lapset = kategoria.childNodes;
        var kategoriatLength = lapset.length;
        var lapsihtml="";
        
        //käydään lapset läpi
        for (var i = 0; i < kategoriatLength; i++) {
            if(lapset[i].nodeName == 'kategoria'){                
                lapsihtml=lapsihtml+tulostakategorianimetyhdelleriville(lapset[i], syvyys-1, vari);
            }
        }
        
        //var tamahtml = "<td>" + kategoria.getAttribute("id")+"&nbsp;" + kategoria.getAttribute("kuvaus") + "</td>";
                
        //jos ollaan liian syvällä
        //if(syvyys<0 && ){
        //    jalkelaismaara=jalkelaismaara+1;
            //return tamahtml+lapsihtml;
        //}else{            
            var pal="";
            var kuvaus="";
            //if(syvyys==0)
                kuvaus=kategoria.getAttribute("kuvaus");
            //jos liian syvällä olevia jalkeläisiä, lisätään colspan
            if(jalkelaismaara>0){
                pal = "<td"+bgc(syvyys+vari)+" colspan=\""+(jalkelaismaara+1).toString()+"\">"+kuvaus+"</td>";
                //pal = "<td"+bgc(syvyys+vari)+">"+kuvaus+" </td>";
                //for(i=0;i<jalkelaismaara;i++)
                //    pal = pal + "<td"+bgc(syvyys+vari)+"> </td>";
            }else
                if(syvyys==0)
                    pal = "<td"+bgc(syvyys+vari)+">"+kuvaus+" </td>"+lapsihtml;
                else
                    pal = "<td"+bgc(vari-syvyys)+">"+kuvaus+" </td>"+lapsihtml;
            jalkelaismaara=0;
            return pal;
        //}
    }
    
    //tekee listauksen, sekä <ul>, <select>, että <tr>.
    function tulostakategoria(kategoria, pvm, syvyys) {
    
        var lapset = kategoria.childNodes;
        var kategoriatLength = lapset.length;
        
        var tamahtml="<td"+bgc(syvyys)+">0</td>";
        var lapsihtml="";

        puu=puu+"<ul>";
        
        for (var i = 0; i < kategoriatLength; i++) {
            if(lapset[i].nodeName == 'kategoria'){
                //alert(lapset[i].getAttribute("kuvaus"));          
                
                
                /*
                if(lapset[i].hasAttribute("kpl")){
                
                    lapsihtml=lapset[i].getAttribute("kpl");
                    //if(parseInt(kpl)>150)
                    //    puu=puu+"<b>";
                        
                    lista=lista+"<option value=\"volvo\">"+lapset[i].getAttribute("id")+"&nbsp;"+lapset[i].getAttribute("kuvaus");
                    puu=puu+"<li>"+lapset[i].getAttribute("kuvaus");                

                    puu=puu+" ("+kpl+")";
                    //if(parseInt(kpl)>150)
                    //    puu=puu+"</b>";
                    lista=lista+" ("+kpl+")";
                    
                    puu=puu+"</li>";
                    lista=lista+"</option>";
                    
                    taul=taul+"<td>"+kpl+"</td>";
                    
                }else{
                
                    taul=taul+"<td>0</td>";
                    
                }
                */
                
                //taul=taul+"<td>"+lapset[i].getAttribute("id")+"&nbsp;"+lapset[i].getAttribute("kuvaus");
                //taul=taul+"<td>"+kpl+"</td>";                
                //taul=taul+"</td>";

                
                lapsihtml=lapsihtml+tulostakategoria(lapset[i], pvm, syvyys+1);

            }
            if(lapset[i].nodeName == 'tavara'){
                //var muoto=lapset[i].childNodes[0].nodeValue;
                //alert(lapset[i].childNodes[0].nodeValue);
                //if (tavara.indexOf(muoto)>-1)
                //    return lapset[i]; 
            }
            if(lapset[i].nodeName == 'paiva'){
                if(lapset[i].getAttribute("pvm")==pvm){
                    textnode = lapset[i].childNodes[0];
                    tamahtml="<td"+bgc(syvyys)+">"+textnode.nodeValue+"</td>";
                }
            }
        }
        
        puu=puu+"</ul>";
        return tamahtml+lapsihtml;
    }
    

    function kopioiTunnisteet() {
        //var inputs = document.getElementsByTagName('input');
        //for (var i = 0; i < inputs.length; i += 1) {
        //    inputs[i].value = '';
        //}​​​​
        var tags = document.getElementsByName('copy');
        var rivit="";//Kopioi seuraavat rivit, ja liitä ne luokitustiedostoon:\n\n";
        var loytyi=false;
        for(var i = 0; i < tags.length; ++i)
        {            
            if(tags[i].checked){
                rivit=rivit+"&lt;tavara&gt;"+tags[i].value.toLowerCase()+"&lt;/tavara&gt;"+"\n";
                loytyi=true;
            }
        }
        if(loytyi)
            //alert(rivit);
            //window.prompt("Kopioi seuraavat rivit, ja liitä ne luokitustiedostoon", rivit);
            CopyToClipboard(rivit);
        else
            alert("Ei yhtään tavaraa valittu.");
    }
    
    function textToHTMLTableSpinner() {
              
        displayContents('<div id="loader"></div>');
        setTimeout(function() {displayContents(textToHTMLTable(kasikirjoitus));}, 0);
        //textToHTMLTable(kasikirjoitus);
    }
    
        
    function loadLuokitus(){
    
        if(xmlDoc==null)
            return "<p>Lataa XML-muotoisen luokitustiedoston.</p> <input type=\"file\" onchange=\"readText(this, xmlloaded);\" />";

		if(xmlDoc.getElementsByTagName("kuvaus").length==0)
			return "<h2>Virheellinen luokitustiedosto</h2><p>Tiedostossa ei ole kuvaus-elementtiä.</p> <input type=\"file\" onchange=\"readText(this, xmlloaded);\" />";

        testkategoria(juuriluokka);

        return "<b>Luokituksen kuvaus:</b> <p>"+xmlDoc.getElementsByTagName("kuvaus")[0].innerHTML+"</p>"+
				"<b>Maksimisyvyys:</b> <p>"+syvintaso+"</p>"+
				"<b>Kategorioita yhteensä:</b> <p>"+kategoriamaara+"</p>"+
				"<b>Tavaroita yhteensä:</b> <p>"+tavaramaara+"</p>"+
				"<b>Virheet:</b> <p><span class=\"virhe\">"+luokitusvirhe+"</span></p>";
        
    }
    
    function textToHTMLTable(text) {
		
        if (kasikirjoitus=="")
			if(xmlDoc==null)
				return "<span class=\"virhe\">Lataa tavaralista ja luokitustiedosto!</span>";
			else
				return "<span class=\"virhe\">Lataa tavaralista!</span>";

		if(xmlDoc==null)
			return "<span class=\"virhe\">Lataa luokitustiedosto!</span>";
			
		if(laske==false)
			return "<span class=\"virhe\">Tavarat on jo tunnistettu. Lataa luokitus uudelleen tehdäksesi uuden tunnistuksen.</span>";


        //var parentDiv = document.getElementById('SomeDiv');
        //parentDiv.appendChild(xmlTextNode);

        
        //localStorage.setItem("lastpaper", "koe2016");
            
        //alert(document.getElementById('tavaraxml').innerHTML);
        //var xml  = xh.responseXML;
        //var xmls = convertXmlToStructure(document.getElementById('tavaraxml'));
        //alert(xmls);
     
        //document.getElementById("demo").innerHTML =
        //alert(xmlDoc.getElementsByTagName("tavara")[0].childNodes[0].nodeValue);
        
        //etsikategoria(xmlDoc.getElementsByTagName("luokitus")[0]);
        
        /*
        var kategoriat = xmlDoc.getElementsByTagName("luokitus")[0].childNodes;
        var kategoriatLength = kategoriat.length;
        
        alert(kategoriatLength);
        for (var i = 0; i < kategoriatLength; i++) {
            if(kategoriat[i].nodeName == 'kategoria')
                alert(kategoriat[i].getAttribute("kuvaus"));
        }*/
        
        
        
        //var rivit=text.split("\n");
        var rivit=text.split(/[\n,]/);
        var arrayLength = rivit.length;
        
        var html="";
        var html_luok="";
        //html=html+"<tr><th>Pvm.</th><th>Kpl.</th><th>Val</th><th>Tavara</th><th>Kategoria</th></tr>";
        html=html+"<h2>Tunnistamattomat</h2><table border=\"1\"><tr><th>Val</th><th>Kirjattu muoto</th><th>Tunnistuskoodi</th></tr>";
        html_luok=html_luok+"<h2>Osittain tunnistetut</h2><table border=\"1\"><tr><th>Kirjattu muoto</th><th>Tunnistettu kategoria</th></tr>";
        
        //var paivays = new Date();
        var paivays = null;
        var entpaivays = null;
        var tavaramaara=0;
        var luokitellut=0;
        var taysintunnistetut=0;
        var lisatyt="";
        
        for (var i = 0; i < arrayLength; i++) {
        
            var rivi=rivit[i];
            var tavara="";
            var kpl="1";
            var luokka="";
            var ruksi="";
        
            if(rivi[0]!='#'){
                    
                //kappalemäärät
                if(pattkpl1.test(rivi)){
                    kpl = pattkpl1.exec(rivi)[1];
                    rivi=rivi.replace(pattkpl1, '');
                    //paivays=dateCapture(capture, paivays);
                }
                if(pattkpl2.test(rivi)){
                    kpl = pattkpl2.exec(rivi)[1];
                    rivi=rivi.replace(pattkpl2, '');
                    //paivays=dateCapture(capture, paivays);
                }
                    
                //napataan päivämäärät (paivays) ja kootaan niistä lista (days)
                if(pattpvm2.test(rivi)){
                
                    capture = pattpvm2.exec(rivi);
                    paivays=dateCapture(capture,paivays);
                    //lisätään päivä listaan
                    if(laske && entpaivays==null || paivays.getDate()!=entpaivays.getDate()){
                        days.push(paivays);
                        entpaivays=paivays;
                    }
                    //pvm = pattpvm2.exec(rivi)[0];
                    rivi=rivi.replace(pattpvm2, '')
                    
                }else{
                
                    if(pattpvm1.test(rivi)){
                        capture = pattpvm1.exec(rivi);                        
                        paivays=dateCapture(capture,paivays);
                        //lisätään päivä listaan
                        if(laske && entpaivays==null || paivays.getDate()!=entpaivays.getDate()){
                            days.push(paivays);
                            entpaivays=paivays;
                        }
                        rivi=rivi.replace(pattpvm1, '')
                    }
                    
                }
                                    
                tavara=rivi.trim().toLowerCase();

                if(tavara!=''){
                
                    //ei samaa tavaraa moneen kertaan
                    var pattern=">"+tavara+"<";
                    if(lisatyt.indexOf(pattern)==-1){
                        tavaramaara++;
                        lisatyt+=pattern;
                            
                        //luokitus
                        var pvmstr = paivays.toISOString().substring(0, 10);
                        //alert(paivays.toISOString().substring(0, 10));
                        
                        luokka = etsikategoria(juuriluokka, tavara, kpl, pvmstr);
                        if (luokka==null || luokka.childNodes[0].nodeValue == "*"){
                            luokka="";
                            ruksi="<input type=\"checkbox\" name=\"copy\" value=\""+tavara+"\">";
                            html=html+"<tr><td>"+ruksi+"</td><td>"+tavara+"</td><td>&lt;tavara&gt;"+tavara+"&lt;/tavara&gt;</td></tr>";
                        }else{
                            //luokka=luokka.childNodes[0].nodeValue;
							//luokka=luokka.parentElement;
							var style="match";
							//alert(tavara+"=="+luokka.childNodes[0].nodeValue);
							if(tavara.length == luokka.childNodes[0].nodeValue.length){
								//style="fullmatch";
								continue;
								taysintunnistetut=taysintunnistetut+1;
                            }
                            tavara=tavara.replace(luokka.childNodes[0].nodeValue, '<u><span class=\"'+style+'\">$&</span></u>')
                            luokka=luokka.parentNode.getAttribute("kuvaus");
                            luokitellut++;
                            html_luok=html_luok+"<tr><td>"+tavara+"</td><td>"+luokka+"</td></tr>";
                        }
                    
                    }
                    
                    //if(etsikategoria(xmlDoc.getElementsByTagName("luokitus")[0], tavara))
                    //  luokka="true";
                
                    //var pvmstring="<span class=\"virhe\">Virhe!</span>";
                    //if(paivays!=null)
                    //    pvmstring=paivays.toLocaleDateString();
                        
                    
                    //html=html+"<tr><td>"+pvmstring+"</td><td>"+kpl+"</td><td>"+ruksi+"</td><td>"+tavara+"</td><td>"+luokka+"</td></tr>";
                    
                }
            }
        }
        
        lisatyt="";
        
        html+="</table>";
        html_luok+="</table>";
        
        var yhteenveto="<p>Kirjauksista löydettiin <b>"+tavaramaara+"</b> erinimistä tavaraa, joista tunnistettu <b>"+luokitellut+" ("+(luokitellut/tavaramaara*100).toFixed(1)+"%)</b>.</p>";
	
        var nappi="<p>Voit valita tiettyyn kategoriaan kuuluvia tavaroita, ja luoda tunnistustiedot automaattisesti.</p><button onclick=\"kopioiTunnisteet();\"  title=\"\">Muodosta automaattinen tunnistus valituille tavaroille</button><div id\=\"leikepoyta\"></div>";
    
        //piilotaspinneri();
	
        //return yhteenveto+html_luok+html+nappi;
        
        laske=false; //määrät on jo laskettu

        return (yhteenveto+html_luok+html+nappi);
    }

    function textToHTMLTree(text) {
        if(juuriluokka==null)
		return "<span class=\"virhe\">Lataa ensin luokitustiedosto</span>";

        puu="<h3>Luokitus</h3><p>Tavaroiden määrät eri luokissa. Kirjauksissa ilmoitetut kappalemäärät on huomioitu.</p>";
        tulostakategoria(juuriluokka);
        return puu;
    }
    
    function kategoriatJaSanat(text) {


        var xmlText = new XMLSerializer().serializeToString(xmlDoc);
        var xmlTextNode = document.createTextNode(xmlText);
        var parentDiv = document.getElementById('Luokat');
        parentDiv.appendChild(xmlTextNode);

        if(juuriluokka==null)
            return "<span class=\"virhe\">Lataa ensin luokitustiedosto</span>";

        lista="<h3>Vertailu</h3><p>Tavaroiden määrä tietyssä kategoriassa ajan mukaan, sekä vertailu toiseen kategoriaan.</p>";
        lista=lista+"<select>";
        tulostakategoria(juuriluokka);
        lista=lista+"</select>";
        return lista;
    }

    function toISODateString(date) {
        return date.toISOString().substring(0, 10);
    }
    
    
    function vie(text) {

        if(juuriluokka==null)
            return "<span class=\"virhe\">Lataa ensin luokitustiedosto</span>";
				
		if(laske==true)
            return "Tunnista tavarat ensin valitsemalla tunnistus-välilehti!";

        var taul="<h3>Vienti muuhun ohjelmaan</h3><p>Taulukon voi kopioida ja liittää taulukkolaskentaohjelmaan, jossa voi tehdä tilastointia.</p>";
        taul=taul+"<table id=\"table\" border=\"0\">";
        
        //for(i=0;i<syvintaso;i++){
            taul=taul+"<tr><th></th>"+tulostakategorianimetyhdelleriville(juuriluokka, 0, 0)+"</tr>";
        //}
        
        if(document.getElementById('tavarapaivat').checked){
            for(var i=0;i<days.length;i++)
                taul=taul+"<tr><th>"+toISODateString(days[i])+"</th>"+tulostakategoria(juuriluokka, toISODateString(days[i]), 0)+"</tr>";
        }else{  
            var i = new Date(days[0].getTime());
            for(;i<days[days.length-1];i.setDate(i.getDate() + 1)){
                taul=taul+"<tr><th>"+toISODateString(i)+"</th>"+tulostakategoria(juuriluokka, toISODateString(i), 0)+"</tr>";
            }
        }
        
        taul=taul+"</table>";
        return taul;
    }
    
    function naytaspinneri() {
    //alert("koe");
        document.getElementById("loader").style.display = "block";
        document.getElementById("main").style.display = "none";
    }
    
    function piilotaspinneri() {
        document.getElementById("loader").style.display = "none";
        document.getElementById("main").style.display = "block";
    }    
    
    /**
     * read text input
     */
    function readText(filePath, callback) {
        //var output = ""; //placeholder for text output
	//alert(filePath.files.length);

        if(filePath.files && filePath.files[0]) {      
	    //alert(filePath.files[0]);     
            reader.onload = function (e) {
                //output = e.target.result;
		callback(filePath.value, e.target.result);
                //displayContents(textToHTMLTable(kasikirjoitus));
                //textToHTMLTable(kasikirjoitus);

            };//end onload()
	    for(i=0;i<filePath.files.length;i++){
		//alert(i);
            	reader.readAsText(filePath.files[i]);
		}

        }//end if html5 filelist support
        else if(ActiveXObject && filePath) { //fallback to IE 6-8 support via ActiveX

            try {
                reader = new ActiveXObject("Scripting.FileSystemObject");
                var file = reader.OpenTextFile(filePath, 1); //ActiveX File Object
                //output = file.ReadAll(); //text contents of file
		//alert(output);
                
                //displayContents(output);
		callback(filePath.value, file.ReadAll());
                file.Close(); //close file "input stream"
            } catch (e) {
                if (e.number == -2146827859) {
                    alert('Ei pääsyä paikallisiin tiedostoihin turvallisuusasetusten vuoksi. Käytä toista selainta tai muuta asetuksia seuraavasti: ' + 
                     'Go to Tools->Internet Options->Security->Custom Level. ' + 
                     'Find the setting for "Initialize and script ActiveX controls not marked as safe" and change it to "Enable" or "Prompt"'); 
                }else{
			alert("Tuntematon virhe");
		}
            }       
        }
        else { //this is where you could fallback to Java Applet, Flash or similar
            return false;
        }       
        return true;
    }   

    function kkloaded(name, content) {
        //document.title = name+" - Tavaraparseri";
        kasikirjoitus=content;
        //output="";
        //textToHTMLTableSpinner();
        displayContents(orginal(kasikirjoitus));
        openCity('Kasikirjoitus');
    }

    function kkmultiloaded(name, content) {
        alert(content);
    }

    function xmlloaded(name, content) {
	//xmlfile=content;
	//alert(content);

    	xmlDoc = parser.parseFromString(content,"text/xml");
		laske=true;
		days = [];
	//if(isParseError(xmlDoc)) 
	//    alert ("XML ei ole kelvollista. Korjaa XML-tiedosto.");

		var kategoria = xmlDoc.getElementsByTagName("kategoria");
		if(kategoria!=null)
			juuriluokka = xmlDoc.getElementsByTagName("kategoria")[0];
		else 
			juuriluokka = null;
	//output="";

        //dump(oDOM.documentElement.nodeName == "parsererror" ? "error while parsing" : oDOM.documentElement.nodeName);

	//textToHTMLTableSpinner();
        displayContents(loadLuokitus());
        openCity('Luokitus');
    }

    /*
    function isParseError(parsedDocument) {
       // parser and parsererrorNS could be cached on startup for efficiency
       var parser = new DOMParser();
       var errorneousParse = parser.parseFromString('<', 'text/xml');
       var parsererrorNS = errorneousParse.getElementsByTagName("parsererror")[0].namespaceURI;

       if (parsererrorNS === 'http://www.w3.org/1999/xhtml') {
            // In PhantomJS the parseerror element doesn't seem to have a special namespace, so we are just guessing here :(
           return parsedDocument.getElementsByTagName("parsererror").length > 0;
       }

       return parsedDocument.getElementsByTagNameNS(parsererrorNS, 'parsererror').length > 0;
    };
	*/

    /**
     * display content using a basic HTML replacement
     */
    function displayContents(txt) {
        var el = document.getElementById('main'); 
        el.innerHTML = txt; //display output in DOM
    }   
    

    /**
     * Kopioi tekstin leikepöydälle. Toteutus tarvitsee elementin div-elementin, jonka nimi on 'leikepoyta'
     */
    function CopyToClipboard(txt) {
        var el = document.getElementById('leikepoyta'); 
        el.innerHTML = "<p>Kopioi seuraava teksti leikepöydälle, ja liitä se luokitustiedostoon sopivaan kategoriaan:</p> <pre>"+txt+"</pre>"; //display output in DOM
        el.scrollIntoView();
    }   
    
    
    function openCity(cityName) {

        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        //tablinks = document.getElementsByClassName("tablinks");
        //for (i = 0; i < tablinks.length; i++) {
        //    tablinks[i].className = tablinks[i].className.replace(" active", "");
        //}

        // Show the current tab, and add an "active" class to the link that opened the tab
        document.getElementById(cityName).style.display = "block";
        //evt.currentTarget.className += " active";

        //document.getElementById(cityName).style.display = "block";
    }
    
    function selectElementContents(el) {
        var body = document.body, range, sel;
        if (document.createRange && window.getSelection) {
            range = document.createRange();
            sel = window.getSelection();
            sel.removeAllRanges();
            try {
                range.selectNodeContents(el);
                sel.addRange(range);
            } catch (e) {
                range.selectNode(el);
                sel.addRange(range);
            }
        } else if (body.createTextRange) {
            range = body.createTextRange();
            range.moveToElementText(el);
            range.select();
        }
    }
    
</script>
</head>

<body onload="checkFileAPI();openCity('Kasikirjoitus');displayContents(orginal(kasikirjoitus));">
    <div id="container">

        Tavaralista (.txt):  <input type="file" onchange="readText(this, kkloaded);" accept=".txt"/>
        Luokitus (.xml): <input type="file" onchange="readText(this, xmlloaded);" accept=".xml"/>
 
        <!--<input type="file" onchange='readText("./vihot/mustaharmaavihko.txt");' />-->
        
        <hr/>   

        <ul class="tab">
            <li><a title="Lataa tavaralista tekstimuodossa." href="javascript:void(0)" class="tablinks" onclick="openCity('Kasikirjoitus');displayContents(orginal(kasikirjoitus));">Tavaralista</a></li>
            <li><a title="Näytä tavaravirta kalenterinäkymässä." href="javascript:void(0)" class="tablinks" onclick="displayContents(muotoiltuLista(kasikirjoitus));openCity('Muotoilu');">Kalenteri</a></li>
            <li><a title="Lataa tavaraluokitus."             href="javascript:void(0)" class="tablinks" onclick="openCity('Luokitus');displayContents(loadLuokitus());">Luokitus</a></li>            
            <li><a title="Tunnista tavarat luokituksen perusteella." href="javascript:void(0)" class="tablinks" onclick="openCity('Tunnistus');textToHTMLTableSpinner();">Tunnistus</a></li>            
			<li><a title="Näytä kokonaistaulukko, jonka voi viedä taulukkolaskentaohjelmaan." href="javascript:void(0)" class="tablinks" onclick="openCity('Vie');displayContents(vie());">Vie taulukkolaskentaohjelmaan</a></li>
			<li><a title="Ohjeita ohjelman käyttämiseen." href="javascript:void(0)" class="tablinks" onclick="openCity('Ohjeet');displayContents('');">Ohjeet</a></li>			
        </ul>

        <div id="Kasikirjoitus" class="tabcontent">
        </div>
        <div id="Muotoilu" class="tabcontent">
            <div name="viikonpaivat">
                <input type="radio" id="arkipaivat"   name="viikonpaivat" value="arkipaivat"> Näytä arkipäivät ma-pe<br>
                <input type="radio" id="kaikkipaivat" name="viikonpaivat" value="kaikkipaivat"> Näytä kaikki viikonpäivät<br>
                <INPUT TYPE="button" NAME="button" Value="Päivitä" onClick="displayContents(muotoiltuLista(kasikirjoitus));">
                <input type="button" value="Valitse koko taulukko" onclick="selectElementContents( document.getElementById('kalenteri') );">
            </div>
        </div>
        <div id="Luokitus" class="tabcontent">
        </div>
        <div id="Tunnistus" class="tabcontent">
        </div>
		
        <div id="Hierarkia" class="tabcontent">
        </div>
        <div id="Luokat" class="tabcontent">
        </div>
		
        <div id="Vie" class="tabcontent">
            <div name="vie">
                <input type="radio" id="tavarapaivat"   name="vie" value="tavarapaivat" checked> Vain päivät joille merkitty tavaroita  <br>
                <input type="radio" id="valipaivat" name="vie" value="valipaivat">   Myös välipäivät                        <br>
                <INPUT TYPE="button" NAME="button" Value="Päivitä" onClick="openCity('Vie');displayContents(vie());">
                <input type="button" value="Valitse koko taulukko" onclick="selectElementContents( document.getElementById('table') );">
            </div>
        </div>
        
        <div id="Ohjeet" class="tabcontent">
        
        <h1>Tavaraparseri - ohjelma tavaravirran jäsentämiseen</h1>
        
        <b><p>Ohjelmalla jäsennetään päivittäistä tavaravirtaa. Tekstitiedostossa luetellut tiedot järjestetään taulukoihin. Tavarat voidaan järjestää hierarkisiin ryhmiin esim. käyttötarkoituksen mukaan. Ohjelma soveltuu kierrätyskeskuksiin, kirpputoreille, tms. jossa tarvitaan pienimuotoista tavaraseurantaa. Data voidaan viedä taulukkolaskentaan mukautuvampaa tilastointia varten.</p></b>
        
        <ol>
            <li>Kirjoitetaan lista tavaroista otsikoituna päivämäärillä.</li>
            <li>Valitaan luokitus tai kirjoitetaan se itse.</li>
            <li>Tunnistetaan listan tavarat automaattisesti. Täydennetään luokitusta, jos tavaraa ei tunnisteta.</li>
            <li>Muodostetaan taulukko, joka viedään taulukkolaskentaohjelmaan</li>
        </ol>

        <h2>Tavaralista</h2>
            
        <p>
            Tavaravirtaa kirjoitetaan tekstitiedostoon rivi riviltä. Kirjaukset tulisi jakaa tiedostoihin jollain mielekkäällä jaolla. Lista ladataan ohjelmaan vasemmasta ylälaidasta. Ohjelma näyttää mahdolliset virheet.
        </p>
        
        <pre>
#Mustaharmaavihko
#13.6.2016-19.8.2016
#86 sivua tavaroita
#------------------------------------------ sivu 1
13.6.
pannu
lautasia 5 kpl
lusikka
lakana
2tyynynpäällistä

14.6.
10 kirjaa
setteri
Rattaat
#------------------------------------------- sivu 2
lasipurkkeja 6 kpl.
polkupyörä
istuin koroke
        </pre>
        
        <p>(Hakemistossa <i>esimerkit/</i> on lisää esimerkkejä tavaralistoista.)</p>

        <h3>Kommentit</h3>
        
        <p>
            Tiedostoon kannattaa lisätä ns. kommentteja. Ne jäsentävät käsikirjoitusta, vaikkakaan niillä ei ole vaikutusta tietoa käsittelevälle ohjelmalle. Kommentit aloitetaan aina risuaidalla (#), jotta kone osaa jättää ne huomioimatta. Esim. jos lista kopioidaan vihosta, sivun vaihtuminen voidaan merkitä esimerkin tavoin.
        </p>


        <h3>Päivämäärät</h3>
        
        <p>
            Tässä on kuvattu muoto, jossa Tavaraparseri-ohjelma olettaa kirjausten olevan.
            Tavaralistaus alkaa päivämäärämerkinnästä. Ensimmäisessä päivämäärässä tulee olla vuosiluku. Päivämäärät voivat olla jossain seuraavissa eri muodoissa:
        
            <ul>
                <li>3.11.2016</li>
                <li>3.11.-16</li>
                <li>3.11.</li>
                <li>3.11</li>
            </ul>
        </p>
        
        <h3>Tavarat</h3>
        
        <p>
            Päivämäärän alta, tai joskus jo samalta riviltä, alkaa lista kyseisenä päivänä kirjatuista tavaroista. Tavarat voidaan jakaa rivinvaihdoilla tai pilkuilla.
            
            <ul>
                <li>lautasia</li>
                <li>juomalaseja, haarukoita</li>
            </ul>
        </p>
            
        <h3>Kappalemäärät</h3>
        
        <p>            
            Tavaroiden määrät voivat olla seuraavissa muodoissa:
            
            <ul>
                <li>3 kpl lautasia</li>
                <li>lautasia 3 kpl</li>
                <li>3x lautanen</li>
                <li>3 x lautanen</li>
                <li>lautanen x3</li>
                <li>lautanen x 3</li>
                <li>3 lautasta</li>
                <li>lautaset 3</li>
            </ul>
        </p>
       
        <h2>Luokitus</h2>
        
        <h3>Luokituksen käyttö ohjelmassa</h3>
        
        <p>
            Luokitus-tiedosto kuvaa luokituksen hierarkian, luokkiin kuuluvien tavaroiden tunnisteet, ja kuvauksen luokituksesta.
        </p>
        
        <p>
            Luokitus avataan ohjelmaan sivun oikeasta ylälaidasta otsikon luokitus -alta. Luokituksen avattua ohjelma näyttää siitä perustietoja.
            Muista ladata myös tavaralista aiemmin kuvatun ohjeen mukaisesti.                         
        </p>
        
        <p>(Valmiita luokituksia löytyy <i>luokitukset/</i> -hakemistosta.)</p>
        
        <h3>Luokituksen muokkaaminen</h3>
        
        <pre>
&lt;luokitus xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
    &lt;kuvaus&gt;
        &lt;p&gt;Yksilöllisen     kulutuksen     käyttötarkoituksenmukainen  luokitus.&lt;/p&gt;
    &lt;/kuvaus&gt;
    &lt;kategoria kuvaus=&quot;Sanomalehdet, kirjat ja paperitavarat&quot;&gt;
        &lt;kategoria kuvaus=&quot;Kirjat&quot;&gt;
            &lt;tavara&gt;kirja&lt;/tavara&gt;
            &lt;tavara&gt;neiti etsivä&lt;/tavara&gt;
            &lt;tavara tunnistus=&quot;kokosana&quot;&gt;pokkari&lt;/tavara&gt;
        &lt;/kategoria&gt;
    &lt;/kategoria&gt;
&lt;/luokitus&gt;
        </pre>
        
        <p>
            Käyttäjä voi luoda uuden luokituksen tai parantaa tunnistamista. Tiedoston muokkaamisessa olisi hyvä olla kokemusta XML-tiedostoista. Toisaalta valmiita luokituksia voi käyttää esimerkkinä. Ohjelmana voi käyttää esim. Notepad++:aa. Luokitus-hakemistossa on määrittelytiedosto kategoria.dtd, jonka avulla voi (siihen tarkoitettua ohjelmaa käyttämällä) tarkastaa XML-tiedoston oikeellisuuden. Määrittelyssä on myös ohjeita XML-tiedoston kirjoittamiseen.
        </p>

        <h2>Tunnistus</h2>
        
        <p>
            Kun molemmat tiedostot on ladattu, valitse välilehti nimeltä Tunnistus. Ohjelma käynnistää automaattisen luokituksen, joka voi kestää muutaman sekunnin. Sen jälkeen ohjelma ilmoittaa tunnistuksen tilan, esimerkiksi:            
        </p>
        
        <p><cite>
            Kirjauksista löydettiin 1079 erinimistä tavaraa, joista tunnistettu 697 (64.6%).
        </cite></p>
        
        <p>
            Tämän alle ohjelma listaa kaksi taulukkoa:
        </p>
        
        <p>
            Ylimmässä taulukossa näkyy kaikki tavarat, jotka on tunnistettu osittain. Tässä on mahdollista
            tarkastaa, onko tavara oikeassa luokassa. Tunnistettu osa on merkitty <u><span class="match">keltaisella alleviivauksella</span></u>. Mikäli luokka ei ole oikea,
            luokitustiedostoon voi jomman kumman korjauksen:
        </p>
        
        <ol>
            <li>Lisää koko sana pidemmässä muodossa.</li>
            <li>Lisää ehto, jonka mukaan tunniste on tarkoitettu koko sanalle.</li>
        </ol>
        
        <p>
            Alimmassa taulukossa näkee kirjaukset, joita ei ole tunnistettu edes osittain.
            Oikeanpuoleisessa sarakkeessa on koodi, jonka tulee lisätä luokitustiedostoon.
            Jos halutaan lisätä monia kirjauksia samaan luokkaan, voidaan ne valita ruksaamalla,
            ja painamalla alapuolella olevaa nappulaa.
        </p>        

       <h2>Vie taulukkolaskentaohjelmaan</h2>
       
       <p>
            Kokonaistaulukko-välilehdestä näet tavaroiden määrän eri luokissa (sarakkeet) ja eri päivinä (rivit).
       </p>
       
       <p>
            Taulukon voi viedä taulukkolaskentaohjelmaan. Valitse koko taulukko maalaamalla se hiirellä,
            tai helpommin klikkaama <i>Valitse koko taulukko</i> -painiketta. Yksittäisiä rivejä voi viedä
            maalaamalla ne taulukon vasemmalta puolelta. Tämä on kätevää, koska taulukkolaskentaan voidaan lisätä päiviä tarvitsematta kopioida otsikkoa ja edellisiä riviä uudestaan.
       </p>
       
       <p>
            Taulukkolaskentaohjelmalla voidaan tehdä diagrammeja valitsemalla kiinnostavia luokkia. Värit auttavat tunnistamaan hierarkian eri tason, jotta samoja tavararoita ei lasketa uusiksi
            hierarkian eri tasoissa.
       </p>

        </div>
        
        <div id="main">
            ...        
        </div>
        

    </div>
    <hr>
    <div align="right">
    Tavaraparseri - ohjelma tavaravirran jäsentämiseen - <a href="http://github.com/jarssoft/Tavaraparseri">http://github.com/jarssoft/Tavaraparseri</a>
    </div>
</body>
</html> 


